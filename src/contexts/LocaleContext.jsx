import React, { createContext, useContext, useState, useMemo } from 'react';

// Move the full translations object here from Admin.jsx
const translations = {
  en: {
    adminDashboard: 'Admin Dashboard',
    todaysSales: "Today's Sales",
    totalRevenue: 'Total Revenue',
    inventoryValue: 'Inventory Value',
    addProduct: 'Add Product',
    backupNow: 'Backup Now',
    settings: 'Settings',
    products: 'Products',
    name: 'Name',
    barcode: 'Barcode',
    price: 'Price',
    stock: 'Stock',
    action: 'Action',
    edit: 'Edit',
    delete: 'Delete',
    salesHistory: 'Sales History',
    date: 'Date',
    total: 'Total',
    view: 'View',
    addProductTitle: 'Add Product',
    close: 'Close',
    backupNowTitle: 'Backup Now',
    settingsTitle: 'Settings',
    changeAdminPassword: 'Change Admin Password',
    changePassword: 'Change Password',
    currentPassword: 'Current Password',
    newPassword: 'New Password',
    confirmPassword: 'Confirm New Password',
    current: 'Current',
    new: 'New',
    confirm: 'Confirm',
    change: 'Change',
    theme: 'Theme',
    light: 'Light',
    dark: 'Dark',
    system: 'System',
    shopInfo: 'Shop Info',
    shopName: 'Shop Name',
    address: 'Address',
    contact: 'Contact',
    save: 'Save',
    backupRestore: 'Backup & Restore',
    restore: 'Restore',
    autoBackup: 'Auto-backup daily',
    googleDriveStatus: 'Google Drive status',
    connected: 'Connected',
    exportData: 'Export Data',
    exportSales: 'Export Sales (CSV)',
    exportInventory: 'Export Inventory (CSV)',
    lowStockAlerts: 'Low Stock Alerts',
    enableNotifications: 'Enable notifications',
    threshold: 'Threshold (e.g. 5)',
    printerSettings: 'Printer Settings',
    testPrint: 'Test Print',
    receiptFormat: '(Receipt format, printer selection, etc.)',
    dangerZone: 'Danger Zone',
    resetAllData: 'Reset All Data',
    eraseWarning: 'This will erase all sales and inventory data. Action is irreversible!',
    aboutSupport: 'About & Support',
    version: 'POS Version 1.0.0',
    contactSupport: 'Contact Support',
    license: 'MIT License',
    language: 'Language',
    english: 'English',
    kurdish: 'Kurdish (Sorani)',
    arabic: 'Arabic',
    // Add extra keys for CRUD feedback
    productAdded: 'Product added:',
    productUpdated: 'Product updated:',
    productDeleted: 'Product deleted:',
    productArchived: 'Product archived:',
    addedToCart: 'Added to cart:',
    confirmDelete: 'Are you sure you want to delete this product?',
    confirmReset: 'Are you sure you want to reset all data? This cannot be undone!',
    search: 'Search...',
    cashier: 'Cashier',
    scanOrEnter: 'Scan or enter barcode',
    add: 'Add',
    checkPrice: 'Check Price',
    returnItem: 'Return Item',
    noItems: 'No items scanned',
    items: 'items',
    adminAccess: 'Admin Access',
    adminPassword: 'Admin password',
    login: 'Login',
    cancel: 'Cancel',
    receiptPreview: 'Receipt Preview',
    productNotFound: 'Product not found',
  },
  ku: {
    adminDashboard: 'پەڕەی بەڕێوەبەر',
    todaysSales: 'فرۆشی ئەمڕۆ',
    totalRevenue: 'کۆی گەورەی داهات',
    inventoryValue: 'نرخی کۆی کاڵا',
    addProduct: 'زیادکردنی کاڵا',
    backupNow: 'پاشەکەوتکردن',
    settings: 'ڕێکخستنەکان',
    products: 'کاڵاکان',
    name: 'ناو',
    barcode: 'بارکۆد',
    price: 'نرخ',
    stock: 'بڕ',
    action: 'کردار',
    edit: 'دەستکاری',
    delete: 'سڕینەوە',
    salesHistory: 'مێژووی فرۆشتن',
    date: 'ڕێکەوت',
    total: 'کۆی گشتی',
    view: 'بینین',
    addProductTitle: 'زیادکردنی کاڵا',
    close: 'داخستن',
    backupNowTitle: 'پاشەکەوتکردن',
    settingsTitle: 'ڕێکخستنەکان',
    changeAdminPassword: 'گۆڕینی وشەی نهێنی',
    changePassword: 'گۆڕینی وشەی نهێنی',
    currentPassword: 'وشەی نهێنی ئێستا',
    newPassword: 'وشەی نهێنی نوێ',
    confirmPassword: 'دووبارە وشەی نهێنی نوێ',
    current: 'هەنووکەیی',
    new: 'نوێ',
    confirm: 'دووبارە',
    change: 'گۆڕین',
    theme: 'ڕووکار',
    light: 'ڕووناک',
    dark: 'تاریک',
    system: 'سیستەم',
    shopInfo: 'زانیاری دوکان',
    shopName: 'ناوی دوکان',
    address: 'ناونیشان',
    contact: 'پەیوەندی',
    save: 'پاشەکەوتکردن',
    backupRestore: 'پاشەکەوت و گەڕاندنەوە',
    restore: 'گەڕاندنەوە',
    autoBackup: 'پاشەکەوتی خۆکار',
    googleDriveStatus: 'دۆخی گووگڵ درایڤ',
    connected: 'پەیوەستکراو',
    exportData: 'هەناردەکردنی داتا',
    exportSales: 'هەناردەی فرۆشتن (CSV)',
    exportInventory: 'هەناردەی کاڵا (CSV)',
    lowStockAlerts: 'ئاگاداری بڕی کەم',
    enableNotifications: 'چالاککردنی ئاگاداری',
    threshold: 'سنوردار (وەک ٥)',
    printerSettings: 'ڕێکخستنی پرینتەر',
    testPrint: 'تاقیکردنەوەی چاپ',
    receiptFormat: '(فۆرمی وەسڵ، هەڵبژاردنی پرینتەر...)',
    dangerZone: 'ناوچەی مەترسیدار',
    resetAllData: 'سڕینەوەی هەموو داتا',
    eraseWarning: 'ئەمە هەموو داتا و کاڵاکانت دەسڕێتەوە. ئەم کردارە گەراندنەوە نییە!',
    aboutSupport: 'دەربارە و یارمەتی',
    version: 'وەشانی POS 1.0.0',
    contactSupport: 'پەیوەندی یارمەتی',
    license: 'MIT License',
    language: 'زمان',
    english: 'ئینگلیزی',
    kurdish: 'کوردی (سۆرانی)',
    arabic: 'عەرەبی',
    // Add extra keys for CRUD feedback
    productAdded: 'زیادکرا:',
    productUpdated: 'نوێکرایەوە:',
    productDeleted: 'سڕایەوە:',
    productArchived: 'ئەرشیفکرا:',
    addedToCart: 'زیادکرا بۆ سەبەتە:',
    confirmDelete: 'دڵنیایت دەتەوێت ئەم کاڵایە بسڕیتەوە؟',
    confirmReset: 'دڵنیایت دەتەوێت هەموو داتاکان بسڕیتەوە؟ ئەمە گەراندنەوە نییە!',
    search: 'گەڕان...',
    cashier: 'کاشێر',
    scanOrEnter: 'بارکۆد بنووسە یان بڵاوە',
    add: 'زیادکردن',
    checkPrice: 'پشکنینی نرخ',
    returnItem: 'گەڕاندنەوەی کاڵا',
    noItems: 'هیچ کاڵایەک نەهاتووە',
    items: 'کاڵا',
    adminAccess: 'دەستگەیشتن بە بەڕێوەبەر',
    adminPassword: 'وشەی نهێنی بەڕێوەبەر',
    login: 'چوونەژوورەوە',
    cancel: 'پاشگەزبوونەوە',
    receiptPreview: 'پیشاندانی وەرگرتن',
    productNotFound: 'کاڵا نەدۆزرایەوە',
    completeSale: 'تەواوکردنی فرۆشتن',
    company: 'کۆمپانیا',
    model: 'مۆدێل',
    archived: 'ئەرشیفکراو',
    debts: 'قەرزەکان',
    paid: 'پارەدراو',
    customerName: 'ناوی کریار',
    amount: 'بڕ',
    noDebts: 'هیچ قەرزێک نییە',
    debt: 'قەرز',
    debtSaleSuccess: 'فرۆشتن بە قەرز تۆمارکرا!',
    confirmDebtSale: 'دڵنیایت دەتەوێت ئەم فرۆشتنە وەک قەرز تۆمار بکەیت؟',
    monthlySales: 'فرۆشی مانگانە',
    archivedProducts: 'کاڵای ئەرشیفکراو',
  },
  ar: {
    adminDashboard: 'لوحة الإدارة',
    todaysSales: 'مبيعات اليوم',
    totalRevenue: 'إجمالي الإيرادات',
    inventoryValue: 'قيمة المخزون',
    addProduct: 'إضافة منتج',
    backupNow: 'نسخ احتياطي الآن',
    settings: 'الإعدادات',
    products: 'المنتجات',
    name: 'الاسم',
    barcode: 'الباركود',
    price: 'السعر',
    stock: 'المخزون',
    action: 'الإجراء',
    edit: 'تعديل',
    delete: 'حذف',
    salesHistory: 'سجل المبيعات',
    date: 'التاريخ',
    total: 'الإجمالي',
    view: 'عرض',
    addProductTitle: 'إضافة منتج',
    close: 'إغلاق',
    backupNowTitle: 'نسخ احتياطي الآن',
    settingsTitle: 'الإعدادات',
    changeAdminPassword: 'تغيير كلمة المرور',
    changePassword: 'تغيير كلمة المرور',
    currentPassword: 'كلمة المرور الحالية',
    newPassword: 'كلمة المرور الجديدة',
    confirmPassword: 'تأكيد كلمة المرور الجديدة',
    current: 'الحالية',
    new: 'الجديدة',
    confirm: 'تأكيد',
    change: 'تغيير',
    theme: 'المظهر',
    light: 'فاتح',
    dark: 'داكن',
    system: 'النظام',
    shopInfo: 'معلومات المتجر',
    shopName: 'اسم المتجر',
    address: 'العنوان',
    contact: 'الاتصال',
    save: 'حفظ',
    backupRestore: 'نسخ واستعادة',
    restore: 'استعادة',
    autoBackup: 'نسخ احتياطي تلقائي',
    googleDriveStatus: 'حالة Google Drive',
    connected: 'متصل',
    exportData: 'تصدير البيانات',
    exportSales: 'تصدير المبيعات (CSV)',
    exportInventory: 'تصدير المخزون (CSV)',
    lowStockAlerts: 'تنبيهات المخزون المنخفض',
    enableNotifications: 'تفعيل الإشعارات',
    threshold: 'الحد الأدنى (مثال 5)',
    printerSettings: 'إعدادات الطابعة',
    testPrint: 'اختبار الطباعة',
    receiptFormat: '(تنسيق الإيصال، اختيار الطابعة، إلخ)',
    dangerZone: 'منطقة الخطر',
    resetAllData: 'إعادة تعيين جميع البيانات',
    eraseWarning: 'سيتم حذف جميع بيانات المبيعات والمخزون. هذا الإجراء لا يمكن التراجع عنه!',
    aboutSupport: 'حول & الدعم',
    version: 'إصدار POS 1.0.0',
    contactSupport: 'اتصل بالدعم',
    license: 'MIT License',
    language: 'اللغة',
    english: 'الإنجليزية',
    kurdish: 'الكردية (سوراني)',
    arabic: 'العربية',
    // Add extra keys for CRUD feedback
    productAdded: 'تمت الإضافة:',
    productUpdated: 'تم التحديث:',
    productDeleted: 'تم الحذف:',
    productArchived: 'تم الأرشفة:',
    addedToCart: 'أضيف إلى السلة:',
    confirmDelete: 'هل أنت متأكد أنك تريد حذف هذا المنتج؟',
    confirmReset: 'هل أنت متأكد أنك تريد إعادة تعيين جميع البيانات؟ لا يمكن التراجع عن هذا!',
    search: 'بحث...',
    cashier: 'الكاشير',
    scanOrEnter: 'أدخل أو امسح الباركود',
    add: 'إضافة',
    checkPrice: 'فحص السعر',
    returnItem: 'إرجاع منتج',
    noItems: 'لا توجد منتجات',
    items: 'منتجات',
    adminAccess: 'دخول المدير',
    adminPassword: 'كلمة مرور المدير',
    login: 'تسجيل الدخول',
    cancel: 'إلغاء',
    receiptPreview: 'معاينة الإيصال',
    productNotFound: 'المنتج غير موجود',
  },
};

const LocaleContext = createContext();

export function LocaleProvider({ children }) {
  const [lang, setLang] = useState(() => localStorage.getItem('lang') || 'en');
  const t = useMemo(() => translations[lang], [lang]);
  const isRTL = lang === 'ar' || lang === 'ku';
  const notoFont = lang === 'ku' ? { fontFamily: 'Noto Sans Arabic, Noto Naskh Arabic, Noto Sans Kurdish, Noto Sans, sans-serif' } : {};

  // Persist language
  React.useEffect(() => {
    localStorage.setItem('lang', lang);
  }, [lang]);

  return (
    <LocaleContext.Provider value={{ lang, setLang, t, isRTL, notoFont }}>
      {children}
    </LocaleContext.Provider>
  );
}

export function useLocale() {
  return useContext(LocaleContext);
}
