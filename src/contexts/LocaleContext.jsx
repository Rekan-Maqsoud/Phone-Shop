import React, { createContext, useContext, useState, useMemo } from 'react';

// Move the full translations object here from Admin.jsx
const translations = {
  en: {
    adminDashboard: 'Admin Dashboard',
    todaysSales: "Today's Sales",
    totalRevenue: 'Total Revenue',
    inventoryValue: 'Inventory Value',
    addProduct: 'Add Product',
    backupNow: 'Backup Now',
    settings: 'Settings',
    products: 'Products',
    name: 'Name',
    barcode: 'Barcode',
    price: 'Price',
    stock: 'Stock',
    quantity: 'Quantity',
    ram: 'RAM',
    storage: 'Storage',
    model: 'Model',
    sellingPrice: 'Selling Price',
    buyingPrice: 'Buying Price',
    action: 'Action',
    edit: 'Edit',
    deleteProduct: 'Delete',
    salesHistory: 'Sales History',
    date: 'Date',
    total: 'Total',
    view: 'View',
    addProductTitle: 'Add Product',
    close: 'Close',
    backupNowTitle: 'Backup Now',
    settingsTitle: 'Settings',
    changeAdminPassword: 'Change Admin Password',
    changePassword: 'Change Password',
    currentPassword: 'Current Password',
    newPassword: 'New Password',
    confirmNewPassword: 'Confirm New Password',
    current: 'Current',
    new: 'New',
    confirm: 'Confirm',
    change: 'Change',
    theme: 'Theme',
    light: 'Light',
    dark: 'Dark',
    system: 'System',
    shopInfo: 'Shop Info',
    shopName: 'Shop Name',
    address: 'Address',
    contact: 'Contact',
    save: 'Save',
    backupRestore: 'Backup & Restore',
    restore: 'Restore',
    autoBackup: 'Auto-backup daily',
    googleDriveStatus: 'Google Drive status',
    connected: 'Connected',
    exportData: 'Export Data',
    exportSales: 'Export Sales (CSV)',
    exportInventory: 'Export Inventory (CSV)',
    lowStockAlerts: 'Low Stock Alerts',
    enableNotifications: 'Enable notifications',
    threshold: 'Threshold (e.g. 5)',
    printerSettings: 'Printer Settings',
    testPrint: 'Test Print',
    receiptFormat: '(Receipt format, printer selection, etc.)',
    dangerZone: 'Danger Zone',
    resetAllData: 'Reset All Data',
    eraseWarning: 'This will erase all sales and inventory data. Action is irreversible!',
    aboutSupport: 'About & Support',
    appVersion: 'POS Version 1.0.0',
    contactSupport: 'Contact Support',
    license: 'MIT License',
    language: 'Language',
    english: 'English',
    kurdish: 'Kurdish (Sorani)',
    arabic: 'Arabic',
    // Add extra keys for CRUD feedback
    productAdded: 'Product added:',
    productUpdated: 'Product updated:',
    productDeleted: 'Product deleted:',
    productArchived: 'Product archived:',
    addedToCart: 'Added to cart:',
    confirmDelete: 'Are you sure you want to delete this product?',
    confirmReset: 'Are you sure you want to reset all data? This cannot be undone!',
    // Missing hardcoded text translations
    unpaidDebts: 'unpaid debts',
    lowStockText: 'low stock',
    allStocksHealthy: 'All stocks healthy',
    left: 'left',
    type: 'Type',
    brand: 'Brand',
    showingItems: 'Showing',
    of: 'of',
    addToCart: 'Add to Cart',
    noBackupMethodConfigured: 'No backup method configured',
    search: 'Search...',
    cashier: 'Cashier',
    scanOrEnter: 'Scan or enter barcode',
    add: 'Add',
    checkPrice: 'Check Price',
    returnItem: 'Return Item',
    noItems: 'No items scanned',
    items: 'items',
    adminAccess: 'Admin Access',
    adminPassword: 'Admin password',
    login: 'Login',
    cancel: 'Cancel',
    receiptPreview: 'Receipt Preview',
    productNotFound: 'Product not found',
    completeSale: 'Complete Sale',
    confirmSale: 'Are you sure you want to complete this sale?',
    confirmDebtSale: 'Are you sure you want to record this sale as debt?',
    saleSuccess: 'Sale completed successfully!',
    saleFailed: 'Sale failed',
    debtSaleSuccess: 'Debt sale recorded successfully!',
    saleApiUnavailable: 'Sale API not available',
    belowBuyingPrice: 'Below buying price!',
    debts: 'Debts',
    totalProfit: 'Total Profit',
    profit: 'Profit',
    searchCustomer: 'Search by customer name...',
    noDebtsFound: 'No debts found for this search',
    markAsPaid: 'Mark as Paid',
    paidAt: 'Paid at',
    paymentTime: 'Payment Time',
    paymentTimeHelp: 'Leave empty to use current time',
    confirmMarkPaid: 'Mark this purchase as paid? This cannot be undone.',
    debtMarkedPaid: 'Debt marked as paid and moved to sales history!',
    // Backup translations
    backupManager: 'Backup Manager',
    manualBackup: 'Manual Backup',
    manualBackupDesc: 'Create a backup of your database to Documents/Mobile Roma BackUp folder',
    autoBackupSystem: 'Auto Backup',
    autoBackupDesc: 'Automatically backup your database every 24 hours',
    enableAutoBackup: 'Enable automatic daily backup',
    createBackup: 'Create Backup',
    creating: 'Creating...',
    backupSuccess: 'Backup created successfully!',
    backupFailed: 'Backup failed',
    autoBackupSystemEnabled: 'Auto backup enabled - Database will be backed up every 24 hours',
    autoBackupSystemDisabled: 'Auto backup disabled',
    autoBackupFailed: 'Failed to toggle auto backup',
    autoBackupActive: 'Auto backup is active. Next backup will be created in approximately 24 hours.',
    restoreBackup: 'Restore from Backup',
    restoreWarning: 'Warning: Restoring from a backup will replace all current data. This action cannot be undone.',
    selectBackupFile: 'Select Backup File',
    restoring: 'Restoring...',
    confirmRestore: 'Are you sure you want to restore from this backup? This will replace all current data!',
    restoreSuccess: 'Database restored successfully!',
    restoreFailed: 'Restore failed',
    backupHistory: 'Backup History',
    noBackups: 'No backups found',
    fileName: 'File Name',
    createdAt: 'Created At',
    backupType: 'Type',
    status: 'Status',
    completed: 'Completed',
    monthlySales: 'Monthly Sales',
    archivedProducts: 'Archived Products',
    // Add missing cloud backup translations  
    passwordsDoNotMatch: 'Passwords do not match',
    authenticationFailed: 'Authentication failed',
    logoutFailed: 'Logout failed',
    createCloudBackup: 'Create Cloud Backup',
    backupName: 'Backup Name',
    backupDescription: 'Description (optional)',
    backupDescriptionPlaceholder: 'Enter a description for this backup...',
    leaveEmptyAutoName: 'Leave empty for automatic name',
    cloudBackups: 'Cloud Backups',
    noCloudBackups: 'No cloud backups found',
    // Product Select Modal
    multipleProductsFound: 'Multiple products found. Select one:',
    selectAction: 'Select',
    ok: 'OK',
    // Company debt management
    addCompanyDebt: 'Add Company Debt',
    companyName: 'Company Name',
    amount: 'Amount',
    description: 'Description (optional)',
    // Missing keys found in Admin.jsx
    dashboard: 'Dashboard',
    accessories: 'Accessories',
    buyingHistory: 'Buying History',
    customerDebts: 'Customer Debts',
    companyDebts: 'Company Debts',
    monthlyReports: 'Monthly Reports',
    logout: 'Log out',
    productUnarchived: 'Item unarchived!',
    archiveFailed: 'Archive failed.',
    unarchiveFailed: 'Unarchive failed.',
    // Missing keys found in Cashier.jsx
    completeSaleNotImplemented: 'Complete sale (not implemented)',
    pleaseEnterProductName: 'Please enter a product name',
    productNotFoundOrInvalid: 'Product not found or invalid',
    offlineWarning: '⚠️ You are offline! This sale will not be backed up to cloud until connection is restored.',
    warningSellingBelowCost: '⚠️ WARNING: Selling below buying price!',
    continueAnyway: 'This will result in a loss. Continue anyway?',
    cannotCompleteNegativeTotal: 'Cannot complete sale with negative total',
    negativeTotal: 'Negative Total!',
    pleaseEnterCustomerName: 'Please enter customer name for debt sale',
    customerNameRequired: 'Customer name is required for debt sales.',
    saleRecordCreationFailed: 'Sale saved but failed to create debt record: ',
    unknownError: 'Unknown error',
    debtCreationFailed: 'Sale saved but debt creation failed: ',
    enterProductName: 'Enter a product name',
    stockLabel: 'Stock:',
    cannotExceedStock: 'Cannot exceed available stock',
    // Cloud backup manager translations
    cloudBackupManager: 'Cloud Backup Manager',
    cloudBackupService: 'Cloud Backup Service',
    signInToEnable: 'Sign in to enable automatic cloud backup after every data change, plus manual backup and restore capabilities',
    signInSignUp: 'Sign In / Sign Up',
    signOut: 'Sign Out',
    storageUsed: 'Storage Used',
    backups: 'backups',
    autoCloudBackupActive: 'Auto Cloud Backup Active (Updates after every change)',
    createManualBackup: 'Create Manual Backup',
    refresh: 'Refresh',
    loading: 'Loading...',
    noCloudBackupsFound: 'No cloud backups found',
    version: 'Version',
    unknownSize: 'Unknown size',
    download: 'Download',
    delete: 'Delete',
    confirmRestoreFromBackup: 'Are you sure you want to restore from "{fileName}"? This will replace all current data!',
    signIn: 'Sign In',
    createAccount: 'Create Account',
    fullName: 'Full Name',
    email: 'Email',
    password: 'Password',
    confirmPassword: 'Confirm Password',
    processing: 'Processing...',
    needAnAccount: 'Need an account?',
    alreadyHaveAccount: 'Already have an account?',
    loggedInSuccessfully: 'Logged in successfully!',
    accountCreatedSuccessfully: 'Account created successfully!',
    loggedOutSuccessfully: 'Logged out successfully',
    
    manualBackupUploadedSuccessfully: 'Manual backup uploaded successfully!',
    failedToUploadManualBackup: 'Failed to upload manual backup',
    failedToCreateLocalBackup: 'Failed to create local backup',
    failedToReadBackupFile: 'Failed to read backup file or file is empty',
    backupApiNotAvailable: 'Backup API not available',
    failedToCreateManualBackup: 'Failed to create manual backup',
    backupDownloadedSuccessfully: 'Backup downloaded successfully! You can now restore it.',
    failedToDownloadBackup: 'Failed to download backup',
    cloudDownloadApiNotAvailable: 'Cloud download API not available',
    downloadedBackupIsEmpty: 'Downloaded backup file is empty or unreadable. Please try again.',
    confirmDownloadRestore: 'Backup downloaded to {path}. Do you want to restore it now?',
    confirmDeleteBackup: 'Are you sure you want to delete "{fileName}"?',
    backupDeletedSuccessfully: 'Backup deleted successfully',
    failedToDeleteBackup: 'Failed to delete backup',
    databaseRestoredSuccessfully: 'Database restored successfully!',
    failedToRestoreBackup: 'Failed to restore backup',
    databaseRestoredRestartRequired: 'Database restored successfully! The application needs to restart to apply changes. Restart now?',
    failedToLoadBackups: 'Failed to load backups',
  },
  ku: {
    adminDashboard: 'پەڕەی بەڕێوەبەر',
    todaysSales: 'فرۆشی ئەمڕۆ',
    totalRevenue: 'کۆی گەورەی داهات',
    inventoryValue: 'نرخی کۆی کاڵا',
    addProduct: 'زیادکردنی کاڵا',
    backupNow: 'پاشەکەوتکردن',
    settings: 'ڕێکخستنەکان',
    products: 'کاڵاکان',
    name: 'ناو',
    barcode: 'بارکۆد',
    price: 'نرخ',
    stock: 'بڕ',
    quantity: 'ژمارە',
    ram: 'یادگە',
    storage: 'گەنجینە',
    model: 'مۆدێل',
    sellingPrice: 'نرخی فرۆشتن',
    buyingPrice: 'نرخی کڕین',
    action: 'کردار',
    edit: 'دەستکاری',
    deleteProduct: 'سڕینەوە',
    salesHistory: 'مێژووی فرۆشتن',
    date: 'ڕێکەوت',
    total: 'کۆی گشتی',
    view: 'بینین',
    addProductTitle: 'زیادکردنی کاڵا',
    close: 'داخستن',
    backupNowTitle: 'پاشەکەوتکردن',
    settingsTitle: 'ڕێکخستنەکان',
    changeAdminPassword: 'گۆڕینی وشەی نهێنی',
    changePassword: 'گۆڕینی وشەی نهێنی',
    currentPassword: 'وشەی نهێنی ئێستا',
    newPassword: 'وشەی نهێنی نوێ',
    confirmNewPassword: 'دووبارە وشەی نهێنی نوێ',
    current: 'هەنووکەیی',
    new: 'نوێ',
    confirm: 'دووبارە',
    change: 'گۆڕین',
    theme: 'ڕووکار',
    light: 'ڕووناک',
    dark: 'تاریک',
    system: 'سیستەم',
    shopInfo: 'زانیاری دوکان',
    shopName: 'ناوی دوکان',
    address: 'ناونیشان',
    contact: 'پەیوەندی',
    save: 'پاشەکەوتکردن',
    backupRestore: 'پاشەکەوت و گەڕاندنەوە',
    restore: 'گەڕاندنەوە',
    autoBackup: 'پاشەکەوتی خۆکار',
    googleDriveStatus: 'دۆخی گووگڵ درایڤ',
    connected: 'پەیوەستکراو',
    exportData: 'هەناردەکردنی داتا',
    exportSales: 'هەناردەی فرۆشتن (CSV)',
    exportInventory: 'هەناردەی کاڵا (CSV)',
    lowStockAlerts: 'ئاگاداری بڕی کەم',
    enableNotifications: 'چالاککردنی ئاگاداری',
    threshold: 'سنوردار (وەک ٥)',
    printerSettings: 'ڕێکخستنی پرینتەر',
    testPrint: 'تاقیکردنەوەی چاپ',
    receiptFormat: '(فۆرمی وەسڵ، هەڵبژاردنی پرینتەر...)',
    dangerZone: 'ناوچەی مەترسیدار',
    resetAllData: 'سڕینەوەی هەموو داتا',
    eraseWarning: 'ئەمە هەموو داتا و کاڵاکانت دەسڕێتەوە. ئەم کردارە گەراندنەوە نییە!',
    aboutSupport: 'دەربارە و یارمەتی',
    appVersion: 'وەشانی POS 1.0.0',
    contactSupport: 'پەیوەندی یارمەتی',
    license: 'MIT License',
    language: 'زمان',
    english: 'ئینگلیزی',
    kurdish: 'کوردی (سۆرانی)',
    arabic: 'عەرەبی',
    // Add extra keys for CRUD feedback
    productAdded: 'زیادکرا:',
    productUpdated: 'نوێکرایەوە:',
    productDeleted: 'سڕایەوە:',
    productArchived: 'ئەرشیفکرا:',
    addedToCart: 'زیادکرا بۆ سەبەتە:',
    confirmDelete: 'دڵنیایت دەتەوێت ئەم کاڵایە بسڕیتەوە؟',
    confirmReset: 'دڵنیایت دەتەوێت هەموو داتاکان بسڕیتەوە؟ ئەمە گەراندنەوە نییە!',
    search: 'گەڕان...',
    cashier: 'کاشێر',
    scanOrEnter: 'بارکۆد بنووسە یان بڵاوە',
    add: 'زیادکردن',
    checkPrice: 'پشکنینی نرخ',
    returnItem: 'گەڕاندنەوەی کاڵا',
    noItems: 'هیچ کاڵایەک نەهاتووە',
    items: 'کاڵا',
    adminAccess: 'دەستگەیشتن بە بەڕێوەبەر',
    adminPassword: 'وشەی نهێنی بەڕێوەبەر',
    login: 'چوونەژوورەوە',
    cancel: 'پاشگەزبوونەوە',
    receiptPreview: 'پیشاندانی وەرگرتن',
    productNotFound: 'کاڵا نەدۆزرایەوە',
    completeSale: 'تەواوکردنی فرۆشتن',
    confirmSale: 'دڵنیایت کە ئەم فرۆشتنە تەواو بکەیت؟',
    confirmDebtSale: 'دڵنیایت دەتەوێت ئەم فرۆشتنە وەک قەرز تۆمار بکەیت؟',
    saleSuccess: 'فرۆشتن بە سەرکەوتووی تەواو بوو!',
    saleFailed: 'فرۆشتن سەرکەوتوو نەبوو',
    debtSaleSuccess: 'فرۆشتن بە قەرز تۆمارکرا!',
    saleApiUnavailable: 'API ی فرۆشتن بەردەست نییە',
    belowBuyingPrice: 'کەمترە لە نرخی کڕین!',
    debts: 'قەرزەکان',
    totalProfit: 'کۆی قازانج',
    profit: 'قازانج',
    searchCustomer: 'گەڕان بە ناوی کریار...',
    noDebtsFound: 'هیچ قەرزێک نەدۆزرایەوە بۆ ئەم گەڕانە',
    markAsPaid: 'نیشانکردن وەک پارەدراو',
    paidAt: 'پارەدرا لە',
    paymentTime: 'کاتی پارەدان',
    paymentTimeHelp: 'بەتاڵی بهێڵە بۆ بەکارهێنانی کاتی ئێستا',
    confirmMarkPaid: 'ئەم کڕینە وەک پارەدراو نیشان بکەیت؟ ئەمە گەراندنەوە نییە.',
    debtMarkedPaid: 'قەرز وەک پارەدراو نیشانکرا و گوازرایەوە بۆ مێژووی فرۆشتن!',
    // Backup translations
    backupManager: 'بەڕێوەبەری پاشەکەوت',
    manualBackup: 'پاشەکەوتی دەستی',
    manualBackupDesc: 'پاشەکەوتێک لە بنکەدراوەکەت بکە بۆ فۆڵدەری بەڵگەکان/Mobile Roma BackUp',
    autoBackupSystem: 'پاشەکەوتی خۆکار',
    autoBackupDesc: 'بە شێوەیەکی خۆکار هەموو ٢٤ کاتژمێر جارێک پاشەکەوت بکە',
    enableAutoBackup: 'چالاککردنی پاشەکەوتی ڕۆژانە',
    createBackup: 'دروستکردنی پاشەکەوت',
    creating: 'دروستکردن...',
    backupSuccess: 'پاشەکەوت بە سەرکەوتووی دروستکرا!',
    backupFailed: 'پاشەکەوت سەرکەوتوو نەبوو',
    autoBackupSystemEnabled: 'پاشەکەوتی خۆکار چالاککرا - بنکەدراوە هەموو ٢٤ کاتژمێر جارێک پاشەکەوت دەکرێت',
    autoBackupSystemDisabled: 'پاشەکەوتی خۆکار ناچالاککرا',
    autoBackupFailed: 'گۆڕینی پاشەکەوتی خۆکار سەرکەوتوو نەبوو',
    autoBackupActive: 'پاشەکەوتی خۆکار چالاکە. پاشەکەوتی داهاتوو بە نزیکی ٢٤ کاتژمێرەوە دروست دەکرێت.',
    restoreBackup: 'گەڕاندنەوە لە پاشەکەوت',
    restoreWarning: 'ئاگاداری: گەڕاندنەوە لە پاشەکەوت هەموو داتای ئێستا دەگۆڕێت. ئەم کردارە ناگەڕێتەوە.',
    selectBackupFile: 'فایلی پاشەکەوت هەڵبژێرە',
    restoring: 'گەڕاندنەوە...',
    confirmRestore: 'دڵنیایت دەتەوێت لەم پاشەکەوتەوە گەڕاندنەوە بکەیت؟ ئەمە هەموو داتای ئێستا دەگۆڕێت!',
    restoreSuccess: 'بنکەدراوە بە سەرکەوتووی گەڕێندرایەوە!',
    restoreFailed: 'گەڕاندنەوە سەرکەوتوو نەبوو',
    backupHistory: 'مێژووی پاشەکەوت',
    noBackups: 'هیچ پاشەکەوتێک نەدۆزرایەوە',
    fileName: 'ناوی فایل',
    createdAt: 'دروستکراوە لە',
    type: 'جۆر',
    status: 'دۆخ',
    completed: 'تەواوبووە',
    monthlySales: 'فرۆشی مانگانە',
    archivedProducts: 'کاڵای ئەرشیفکراو',
    // UI and navigation
    enterName: 'ناو بنووسە',
    backToAdmin: 'گەڕانەوە بۆ بەڕێوەبەر',
    businessOverview: 'پیشاندانی کاروبار',
    quickActions: 'کردارە خێراکان',
    archived: 'ئەرشیفکراو',
    manageDebts: 'بەڕێوەبردنی قەرزەکان',
    logout: 'دەرچوون',
    createCloudBackup: 'دروستکردنی پاشەکەوتی هەور',
    backupName: 'ناوی پاشەکەوت',
    backupDescription: 'وەسف (ئۆپشنال)',
    backupDescriptionPlaceholder: 'وەسفێک بنووسە بۆ ئەم پاشەکەوتە...',
    leaveEmptyAutoName: 'بەتاڵی بهێڵە بۆ ناوی خۆکار',
    cloudBackups: 'پاشەکەوتی هەور',
    noCloudBackups: 'هیچ پاشەکەوتی هەورێک نەدۆزرایەوە',
    // Product Select Modal
    multipleProductsFound: 'چند کاڵایەک دۆزرایەوە. یەکێک هەڵبژێرە:',
    selectAction: 'هەڵبژاردن',
    ok: 'باشە',
    // Company debt management (these already exist in Arabic)
    // Missing keys found in Admin.jsx
    dashboard: 'سەرەکی',
    accessories: 'زێوەکان',
    buyingHistory: 'مێژووی کڕین',
    customerDebts: 'قەرزی کریار',
    companyDebts: 'قەرزی کۆمپانیا',
    monthlyReports: 'ڕاپۆرتی مانگانە',
    productUnarchived: 'کاڵا لە ئەرشیف دەرچوو!',
    archiveFailed: 'ئەرشیفکردن سەرکەوتوو نەبوو.',
    unarchiveFailed: 'دەرخستنی ئەرشیف سەرکەوتوو نەبوو.',
    // Missing keys found in Cashier.jsx
    completeSaleNotImplemented: 'تەواوکردنی فرۆشتن (جێبەجێ نەکراوە)',
    pleaseEnterProductName: 'تکایە ناوی کاڵا بنووسە',
    productNotFoundOrInvalid: 'کاڵا نەدۆزرایەوە یان هەڵەیە',
    offlineWarning: '⚠️ تۆ پەیوەندیت نییە! ئەم فرۆشتنە بۆ هەور پاشەکەوت ناکرێت تا پەیوەندی بگەڕێتەوە.',
    warningSellingBelowCost: '⚠️ ئاگاداری: فرۆشتن بە نرخێکی کەمتر لە نرخ کڕین!',
    continueAnyway: 'ئەمە زیان دەبێت. دەتەوێت بەردەوام بیت؟',
    cannotCompleteNegativeTotal: 'ناتوانرێت فرۆشتن بە کۆی گشتییەکی نەگونجاو تەواو بکرێت',
    negativeTotal: 'کۆی گشتی نەگونجاو!',
    pleaseEnterCustomerName: 'تکایە ناوی کریار بنووسە بۆ فرۆشتنی قەرز',
    customerNameRequired: 'ناوی کریار پێویستە بۆ فرۆشتنی قەرز.',
    saleRecordCreationFailed: 'فرۆشتن تۆمارکرا بەڵام تۆمارکردنی قەرز سەرکەوتوو نەبوو: ',
    unknownError: 'هەڵەی نەناسراو',
    debtCreationFailed: 'فرۆشتن تۆمارکرا بەڵام دروستکردنی قەرز سەرکەوتوو نەبوو: ',
    customerNameOptional: 'ناوی کریار (ئۆپشنال)',
    stockLabel: 'بڕ:',
    cannotExceedStock: 'ناتوانرێت بڕی بەردەست تێپەڕێنیت',
    overview: 'پیشاندانی گشتی',
    recentSales: 'فرۆشتنی نوێ',
    topProducts: 'باشترین کاڵاکان',
    sold: 'فرۆشرا',
    todaysPerformance: 'کارایی ئەمڕۆ',
    revenue: 'داهات',
    sales: 'فرۆشتن',
    spending: 'خەرجی',
    netPerformance: 'کارایی خالص',
    thisMonth: 'ئەم مانگە',
    stockAlerts: 'ئاگاداری بڕی کەم',
    left: 'ماوە',
    lowStock: 'بڕی کەم',
    outstanding: 'ماوە',
    enterProductName: 'ناوی کاڵا بنووسە',
    // Cloud backup manager translations
    cloudBackupManager: 'بەڕێوەبەری پاشەکەوتی هەور',
    cloudBackupService: 'خزمەتی پاشەکەوتی هەور',
    signInToEnable: 'بچۆرە ژوورەوە بۆ چالاککردنی پاشەکەوتی خۆکاری هەور لە دوای هەر گۆڕانکارییەک، لەگەڵ توانای پاشەکەوت و گەڕاندنەوەی دەستی',
    signInSignUp: 'چوونەژوورەوە / دروستکردنی هەژمار',
    signOut: 'دەرچوون',
    storageUsed: 'گەنجینەی بەکارهاتوو',
    backups: 'پاشەکەوت',
    autoCloudBackupActive: 'پاشەکەوتی خۆکاری هەور چالاکە (نوێکردنەوە لە دوای هەر گۆڕانکارییەک)',
    createManualBackup: 'دروستکردنی پاشەکەوتی دەستی',
    refresh: 'نوێکردنەوە',
    loading: 'بارکردن...',
    noCloudBackupsFound: 'هیچ پاشەکەوتی هەورێک نەدۆزرایەوە',
    version: 'وەشان',
    unknownSize: 'قەبارەی نەناسراو',
    download: 'داگرتن',
    delete: 'سڕینەوە',
    confirmRestoreFromBackup: 'دڵنیایت دەتەوێت لە "{fileName}"ەوە گەڕاندنەوە بکەیت؟ ئەمە هەموو داتای ئێستا دەگۆڕێت!',
    signIn: 'چوونەژوورەوە',
    createAccount: 'دروستکردنی هەژمار',
    fullName: 'ناوی تەواو',
    email: 'ئیمەیڵ',
    password: 'وشەی نهێنی',
    confirmPassword: 'دووبارە وشەی نهێنی',
    processing: 'پرۆسێسکردن...',
    needAnAccount: 'هەژمارت پێویستە؟',
    alreadyHaveAccount: 'پێشتر هەژمارت هەیە؟',
    loggedInSuccessfully: 'بە سەرکەوتووی چوویتە ژوورەوە!',
    accountCreatedSuccessfully: 'هەژمار بە سەرکەوتووی دروستکرا!',
    loggedOutSuccessfully: 'بە سەرکەوتووی دەرچووی',
  
    manualBackupUploadedSuccessfully: 'پاشەکەوتی دەستی بە سەرکەوتووی بارکرا!',
    failedToUploadManualBackup: 'بارکردنی پاشەکەوتی دەستی سەرکەوتوو نەبوو',
    failedToCreateLocalBackup: 'دروستکردنی پاشەکەوتی ناوخۆیی سەرکەوتوو نەبوو',
    failedToReadBackupFile: 'خوێندنەوەی فایلی پاشەکەوت سەرکەوتوو نەبوو یان فایل بەتاڵە',
    backupApiNotAvailable: 'API ی پاشەکەوت بەردەست نییە',
    failedToCreateManualBackup: 'دروستکردنی پاشەکەوتی دەستی سەرکەوتوو نەبوو',
    backupDownloadedSuccessfully: 'پاشەکەوت بە سەرکەوتووی داگیرا! ئێستا دەتوانیت گەڕاندنەوەی بکەیت.',
    // Missing hardcoded text translations
    unpaidDebts: 'قەرزی نەدراو',
    lowStockText: 'بڕی کەم',
    allStocksHealthy: 'هەموو بڕەکان باشن',
    showingItems: 'پیشاندان',
    of: 'لە',
    addToCart: 'زیادکردن بە سەبەت',
    noBackupMethodConfigured: 'شێوازی پاشەکەوت ڕێکنەخراوە',
    failedToDownloadBackup: 'داگرتنی پاشەکەوت سەرکەوتوو نەبوو',
    cloudDownloadApiNotAvailable: 'API ی داگرتنی هەور بەردەست نییە',
    downloadedBackupIsEmpty: 'فایلی پاشەکەوتی داگیراو بەتاڵە یان ناخوێندرێتەوە. تکایە دووبارە هەوڵ بدەوە.',
    confirmDownloadRestore: 'پاشەکەوت داگیرا بۆ {path}. دەتەوێت ئێستا گەڕاندنەوەی بکەیت؟',
    confirmDeleteBackup: 'دڵنیایت دەتەوێت "{fileName}" بسڕیتەوە؟',
    backupDeletedSuccessfully: 'پاشەکەوت بە سەرکەوتووی سڕایەوە',
    failedToDeleteBackup: 'سڕینەوەی پاشەکەوت سەرکەوتوو نەبوو',
    databaseRestoredSuccessfully: 'بنکەدراوە بە سەرکەوتووی گەڕێندرایەوە!',
    failedToRestoreBackup: 'گەڕاندنەوەی پاشەکەوت سەرکەوتوو نەبوو',
    databaseRestoredRestartRequired: 'بنکەدراوە بە سەرکەوتووی گەڕێندرایەوە! پێویستە ئەپلیکەیشنەکە دووبارە دەست پێ بکاتەوە بۆ جێبەجێکردنی گۆڕانکارییەکان. ئێستا دووبارە دەست پێ بکاتەوە؟',
    failedToLoadBackups: 'بارکردنی پاشەکەوتەکان سەرکەوتوو نەبوو',
  },
  ar: {
    adminDashboard: 'لوحة الإدارة',
    todaysSales: 'مبيعات اليوم',
    totalRevenue: 'إجمالي الإيرادات',
    inventoryValue: 'قيمة المخزون',
    addProduct: 'إضافة منتج',
    backupNow: 'نسخ احتياطي الآن',
    settings: 'الإعدادات',
    products: 'المنتجات',
    name: 'الاسم',
    barcode: 'الباركود',
    price: 'السعر',
    stock: 'المخزون',
    quantity: 'الكمية',
    ram: 'الذاكرة',
    storage: 'التخزين',
    model: 'الموديل',
    sellingPrice: 'سعر البيع',
    buyingPrice: 'سعر الشراء',
    action: 'الإجراء',
    edit: 'تعديل',
    deleteProduct: 'حذف',
    salesHistory: 'سجل المبيعات',
    date: 'التاريخ',
    total: 'الإجمالي',
    view: 'عرض',
    addProductTitle: 'إضافة منتج',
    close: 'إغلاق',
    backupNowTitle: 'نسخ احتياطي الآن',
    settingsTitle: 'الإعدادات',
    changeAdminPassword: 'تغيير كلمة المرور',
    changePassword: 'تغيير كلمة المرور',
    currentPassword: 'كلمة المرور الحالية',
    newPassword: 'كلمة المرور الجديدة',
    confirmNewPassword: 'تأكيد كلمة المرور الجديدة',
    current: 'الحالية',
    new: 'الجديدة',
    confirm: 'تأكيد',
    change: 'تغيير',
    theme: 'المظهر',
    light: 'فاتح',
    dark: 'داكن',
    system: 'النظام',
    shopInfo: 'معلومات المتجر',
    shopName: 'اسم المتجر',
    address: 'العنوان',
    contact: 'الاتصال',
    save: 'حفظ',
    backupRestore: 'نسخ واستعادة',
    restore: 'استعادة',
    autoBackup: 'نسخ احتياطي تلقائي',
    googleDriveStatus: 'حالة Google Drive',
    connected: 'متصل',
    exportData: 'تصدير البيانات',
    exportSales: 'تصدير المبيعات (CSV)',
    exportInventory: 'تصدير المخزون (CSV)',
    lowStockAlerts: 'تنبيهات المخزون المنخفض',
    enableNotifications: 'تفعيل الإشعارات',
    threshold: 'الحد الأدنى (مثال 5)',
    printerSettings: 'إعدادات الطابعة',
    testPrint: 'اختبار الطباعة',
    receiptFormat: '(تنسيق الإيصال، اختيار الطابعة، إلخ)',
    dangerZone: 'منطقة الخطر',
    resetAllData: 'إعادة تعيين جميع البيانات',
    eraseWarning: 'سيتم حذف جميع بيانات المبيعات والمخزون. هذا الإجراء لا يمكن التراجع عنه!',
    aboutSupport: 'حول & الدعم',
    appVersion: 'إصدار POS 1.0.0',
    contactSupport: 'اتصل بالدعم',
    license: 'MIT License',
    language: 'اللغة',
    english: 'الإنجليزية',
    kurdish: 'الكردية (سوراني)',
    arabic: 'العربية',
    // Add extra keys for CRUD feedback
    productAdded: 'تمت الإضافة:',
    productUpdated: 'تم التحديث:',
    productDeleted: 'تم الحذف:',
    productArchived: 'تم الأرشفة:',
    addedToCart: 'أضيف إلى السلة:',
    confirmDelete: 'هل أنت متأكد أنك تريد حذف هذا المنتج؟',
    confirmReset: 'هل أنت متأكد أنك تريد إعادة تعيين جميع البيانات؟ لا يمكن التراجع عن هذا!',
    search: 'بحث...',
    cashier: 'الكاشير',
    scanOrEnter: 'أدخل أو امسح الباركود',
    add: 'إضافة',
    checkPrice: 'فحص السعر',
    returnItem: 'إرجاع منتج',
    noItems: 'لا توجد منتجات',
    items: 'منتجات',
    adminAccess: 'دخول المدير',
    adminPassword: 'كلمة مرور المدير',
    login: 'تسجيل الدخول',
    cancel: 'إلغاء',
    receiptPreview: 'معاينة الإيصال',
    productNotFound: 'المنتج غير موجود',
    confirmSale: 'هل أنت متأكد من إتمام هذا البيع؟',
    confirmDebtSale: 'هل أنت متأكد من تسجيل هذا البيع كدين؟',
    saleSuccess: 'تم إتمام البيع بنجاح!',
    saleFailed: 'فشل البيع',
    debtSaleSuccess: 'تم تسجيل بيع بالدين بنجاح!',
    saleApiUnavailable: 'واجهة البيع غير متاحة',
    belowBuyingPrice: 'أقل من سعر الشراء!',
    debts: 'الديون',
    totalProfit: 'إجمالي الربح',
    profit: 'الربح',
    searchCustomer: 'البحث باسم العميل...',
    noDebtsFound: 'لم يتم العثور على ديون لهذا البحث',
    markAsPaid: 'تحديد كمدفوع',
    paidAt: 'دُفع في',
    paymentTime: 'وقت الدفع',
    paymentTimeHelp: 'اتركه فارغاً لاستخدام الوقت الحالي',
    confirmMarkPaid: 'تحديد هذه المشتريات كمدفوعة؟ لا يمكن التراجع عن هذا.',
    debtMarkedPaid: 'تم تحديد الدين كمدفوع ونُقل إلى تاريخ المبيعات!',
    // Backup translations
    backupManager: 'مدير النسخ الاحتياطية',
    manualBackup: 'نسخ احتياطي يدوي',
    manualBackupDesc: 'إنشاء نسخة احتياطية من قاعدة البيانات إلى مجلد المستندات/Mobile Roma BackUp',
    autoBackupSystem: 'نسخ احتياطي تلقائي',
    autoBackupDesc: 'إنشاء نسخة احتياطية تلقائياً كل 24 ساعة',
    enableAutoBackup: 'تفعيل النسخ الاحتياطي اليومي التلقائي',
    createBackup: 'إنشاء نسخة احتياطية',
    creating: 'جاري الإنشاء...',
    backupSuccess: 'تم إنشاء النسخة الاحتياطية بنجاح!',
    backupFailed: 'فشل في إنشاء النسخة الاحتياطية',
    autoBackupSystemEnabled: 'تم تفعيل النسخ الاحتياطي التلقائي - سيتم إنشاء نسخة احتياطية كل 24 ساعة',
    autoBackupSystemDisabled: 'تم إلغاء تفعيل النسخ الاحتياطي التلقائي',
    autoBackupFailed: 'فشل في تغيير إعدادات النسخ الاحتياطية التلقائية',
    autoBackupActive: 'النسخ الاحتياطي التلقائي نشط. سيتم إنشاء النسخة التالية خلال 24 ساعة تقريباً.',
    restoreBackup: 'استعادة من النسخة الاحتياطية',
    restoreWarning: 'تحذير: الاستعادة من النسخة الاحتياطية ستستبدل جميع البيانات الحالية. لا يمكن التراجع عن هذا الإجراء.',
    selectBackupFile: 'اختيار ملف النسخة الاحتياطية',
    restoring: 'جاري الاستعادة...',
    confirmRestore: 'هل أنت متأكد من الاستعادة من هذه النسخة الاحتياطية؟ سيتم استبدال جميع البيانات الحالية!',
    restoreSuccess: 'تمت استعادة قاعدة البيانات بنجاح!',
    restoreFailed: 'فشلت الاستعادة',
    backupHistory: 'تاريخ النسخ الاحتياطية',
    noBackups: 'لم يتم العثور على نسخ احتياطية',
    fileName: 'اسم الملف',
    createdAt: 'تم الإنشاء في',
    type: 'النوع',
    status: 'الحالة',
    completed: 'مكتمل',
    monthlySales: 'المبيعات الشهرية',
    archivedProducts: 'المنتجات المؤرشفة',
    // UI and navigation
    enterName: 'أدخل الاسم',
    backToAdmin: 'العودة للإدارة',
    overview: 'نظرة عامة',
    businessOverview: 'نظرة عامة على الأعمال',
    quickActions: 'إجراءات سريعة',
    archived: 'المؤرشفة',
    manageDebts: 'إدارة الديون',
    // Removed duplicate salesHistory and products keys
    logout: 'تسجيل الخروج',
    // Cloud backup translations
    cloudBackupManager: 'مدير النسخ الاحتياطية السحابية',
    cloudBackupService: 'خدمة النسخ الاحتياطي السحابي',
    signInSignUp: 'تسجيل الدخول / إنشاء حساب',
    signOut: 'تسجيل الخروج',
    createAccount: 'إنشاء حساب',
    signIn: 'تسجيل الدخول',
    fullName: 'الاسم الكامل',
    email: 'البريد الإلكتروني',
    password: 'كلمة المرور',
    confirmPassword: 'تأكيد كلمة المرور',
    needAccount: 'تحتاج إلى حساب؟',
    alreadyHaveAccount: 'لديك حساب بالفعل؟',
    accountCreatedSuccess: 'تم إنشاء الحساب بنجاح!',
    loggedInSuccess: 'تم تسجيل الدخول بنجاح!',
    loggedOutSuccess: 'تم تسجيل الخروج بنجاح!',
    passwordsDoNotMatch: 'كلمات المرور غير متطابقة',
    authenticationFailed: 'فشل في المصادقة',
    logoutFailed: 'فشل في تسجيل الخروج',
    // Buying history and performance translations for Arabic
    buyingHistory: 'تاريخ الشراء',
    noBuyingHistory: 'لم يتم العثور على تاريخ شراء',
    spending: 'الإنفاق',
    netPerformance: 'الأداء الصافي',
    todaysPerformance: 'أداء اليوم',
    // Missing translations for hardcoded strings in Arabic
    completeSaleNotImplemented: 'إتمام البيع (غير مُطبق)',
    unknown: 'غير معروف',
    offlineWarning: '⚠️ أنت غير متصل! لن يتم نسخ هذا البيع احتياطياً إلى السحابة حتى يتم استعادة الاتصال.',
    warningSellingBelowCost: '⚠️ تحذير: البيع بأقل من سعر الشراء!',
    continueAnyway: 'سيؤدي هذا إلى خسارة. هل تريد المتابعة؟',
    cannotCompleteNegativeTotal: 'لا يمكن إتمام البيع بإجمالي سالب',
    negativeTotal: 'إجمالي سالب!',
    customerNameRequired: 'اسم العميل مطلوب لمبيعات الدين.',
    saleRecordCreationFailed: 'تم حفظ البيع لكن فشل في إنشاء سجل الدين: ',
    unknownError: 'خطأ غير معروف',
    debtCreationFailed: 'تم حفظ البيع لكن فشل في إنشاء الدين: ',
    processing: 'جاري المعالجة...',
    cannotExceedStock: 'لا يمكن تجاوز المخزون المتاح',
    availableStock: 'المخزون المتاح: ',
    maxStockReached: 'تم الوصول للحد الأقصى للمخزون!',
    pleaseEnterProductName: 'يرجى إدخال اسم المنتج',
    productNotFoundOrInvalid: 'المنتج غير موجود أو غير صحيح',
    pleaseEnterCustomerName: 'يرجى إدخال اسم العميل لبيع الدين',
    enterCustomerName: 'يرجى إدخال اسم العميل لبيع الدين',
    customer: 'العميل',
    saleDetails: 'تفاصيل البيع',
    qty: 'الكمية',
    productProfit: 'ربح المنتج',
    accessoryProfit: 'ربح الإكسسوار',
    accessories: 'الإكسسوارات',
    dashboard: 'لوحة التحكم',
    customerDebts: 'ديون العملاء',
    companyDebts: 'ديون الشركة',
    monthlyReports: 'التقارير الشهرية',
    addCompanyDebt: 'إضافة دين شركة',
    companyName: 'اسم الشركة',
    amount: 'المبلغ',
    description: 'الوصف (اختياري)',
    productUnarchived: 'تم إلغاء أرشفة العنصر!',
    archiveFailed: 'فشلت الأرشفة.',
    unarchiveFailed: 'فشل إلغاء الأرشفة.',
    thisMonth: 'هذا الشهر',
    stockAlerts: 'تنبيهات المخزون',
    critical: 'حرج',
    lowStock: 'منخفض',
    outstanding: 'متبقي',
    paidToday: 'دُفع اليوم',
    topProducts: 'أفضل المنتجات',
    sold: 'بيع',
    noSalesDataYet: 'لا توجد بيانات مبيعات بعد',
    recentSales: 'المبيعات الحديثة',
    debt: 'دين',
    noRecentSales: 'لا توجد مبيعات حديثة',
    left: 'متبقي',
    allStocksHealthy: 'جميع المخزون سليم',
    loading: 'جاري التحميل...',
    noProducts: 'لم يتم العثور على منتجات.',
    customerName: 'اسم العميل (مطلوب)',
    customerNameOptional: 'اسم العميل (اختياري)',
    confirmReturnSale: 'هل أنت متأكد من إرجاع هذا البيع بالكامل؟ سيتم استعادة المخزون وإزالة البيع من السجلات.',
    confirmReturnItem: 'هل أنت متأكد من إرجاع هذا العنصر؟ سيتم استعادة المخزون وإزالة العنصر من البيع.',
    markDebtAsPaidConfirm: 'هل أنت متأكد من تحديد هذا الدين كمدفوع؟ لا يمكن التراجع عن هذا الإجراء.',
    created: 'تم الإنشاء',
    paidOn: 'دُفع في',
    markDebtAsPaid: 'تحديد دين {company} كمدفوع؟',
    totalItems: 'إجمالي العناصر',
    enterProductName: 'أدخل اسم المنتج',
    stockLabel: 'المخزون:',
    signInToEnable: 'سجل الدخول لتفعيل النسخ الاحتياطي التلقائي السحابي بعد كل تغيير في البيانات، بالإضافة إلى إمكانيات النسخ الاحتياطي والاستعادة اليدوية',
    storageUsed: 'المساحة المستخدمة',
    backups: 'نسخ احتياطية',
    autoCloudBackupActive: 'النسخ الاحتياطي السحابي التلقائي نشط (التحديث بعد كل تغيير)',
    createManualBackup: 'إنشاء نسخة احتياطية يدوية',
    refresh: 'تحديث',
    noCloudBackupsFound: 'لم يتم العثور على نسخ احتياطية سحابية',
    version: 'الإصدار',
    unknownSize: 'حجم غير معروف',
    download: 'تحميل',
    delete: 'حذف',
    confirmRestoreFromBackup: 'هل أنت متأكد من الاستعادة من "{fileName}"؟ سيتم استبدال جميع البيانات الحالية!',
    needAnAccount: 'تحتاج إلى حساب؟',
    loggedInSuccessfully: 'تم تسجيل الدخول بنجاح!',
    accountCreatedSuccessfully: 'تم إنشاء الحساب بنجاح!',
    loggedOutSuccessfully: 'تم تسجيل الخروج بنجاح',
    
    manualBackupUploadedSuccessfully: 'تم رفع النسخة الاحتياطية اليدوية بنجاح!',
    failedToUploadManualBackup: 'فشل في رفع النسخة الاحتياطية اليدوية',
    failedToCreateLocalBackup: 'فشل في إنشاء النسخة الاحتياطية المحلية',
    failedToReadBackupFile: 'فشل في قراءة ملف النسخة الاحتياطية أو الملف فارغ',
    backupApiNotAvailable: 'واجهة النسخ الاحتياطي غير متاحة',
    failedToCreateManualBackup: 'فشل في إنشاء النسخة الاحتياطية اليدوية',
    backupDownloadedSuccessfully: 'تم تحميل النسخة الاحتياطية بنجاح! يمكنك الآن استعادتها.',
    failedToDownloadBackup: 'فشل في تحميل النسخة الاحتياطية',
    cloudDownloadApiNotAvailable: 'واجهة التحميل السحابي غير متاحة',
    downloadedBackupIsEmpty: 'ملف النسخة الاحتياطية المحملة فارغ أو غير قابل للقراءة. يرجى المحاولة مرة أخرى.',
    confirmDownloadRestore: 'تم تحميل النسخة الاحتياطية إلى {path}. هل تريد استعادتها الآن؟',
    confirmDeleteBackup: 'هل أنت متأكد من حذف "{fileName}"؟',
    backupDeletedSuccessfully: 'تم حذف النسخة الاحتياطية بنجاح',
    failedToDeleteBackup: 'فشل في حذف النسخة الاحتياطية',
    databaseRestoredSuccessfully: 'تمت استعادة قاعدة البيانات بنجاح!',
    failedToRestoreBackup: 'فشلت استعادة النسخة الاحتياطية',
    databaseRestoredRestartRequired: 'تمت استعادة قاعدة البيانات بنجاح! يحتاج التطبيق إلى إعادة التشغيل لتطبيق التغييرات. إعادة التشغيل الآن؟',
    failedToLoadBackups: 'فشل في تحميل النسخ الاحتياطية',
    // Missing hardcoded text translations
    unpaidDebts: 'ديون غير مدفوعة',
    lowStockText: 'مخزون منخفض',
    showingItems: 'عرض',
    of: 'من',
    addToCart: 'إضافة للسلة',
    noBackupMethodConfigured: 'لم يتم تكوين طريقة النسخ الاحتياطي',
  },
};

const LocaleContext = createContext();

function getTranslation(lang, key) {
  if (translations[lang] && translations[lang][key]) return translations[lang][key];
  if (translations['en'] && translations['en'][key]) return translations['en'][key];
  return key;
}

export function LocaleProvider({ children }) {
  const [lang, setLang] = useState(() => localStorage.getItem('lang') || 'en');
  const t = useMemo(() => {
    // Proxy to fallback to English if key missing in selected language
    return new Proxy(translations[lang] || translations['en'], {
      get(target, prop) {
        return target[prop] || translations['en'][prop] || prop;
      }
    });
  }, [lang]);
  const isRTL = lang === 'ar' || lang === 'ku';
  const notoFont = (lang === 'ar' || lang === 'ku')
    ? { fontFamily: 'Noto Sans Arabic, Noto Naskh Arabic, Noto Sans Kurdish, Noto Sans, sans-serif' }
    : {};

  // Persist language
  React.useEffect(() => {
    localStorage.setItem('lang', lang);
  }, [lang]);

  return (
    <LocaleContext.Provider value={{ lang, setLang, t, isRTL, notoFont }}>
      {children}
    </LocaleContext.Provider>
  );
}

export function useLocale() {
  return useContext(LocaleContext);
}
